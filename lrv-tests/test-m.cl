

(load "../lrv-korr/packages.lisp")
(load "../lrv-korr/env-lrv.cl")
(load "../lrv-korr/fmt-lrv.cl")
(load "../lrv-korr/kone-lrv.cl")

(load "./test-rvasm.cl")

;; (load "~/.eclrc")
(load "../lrv-ins/M-lrv.cl")

(defpackage "TEST-M-32"
  (:documentation "Test functions for the risc-v 32 bit mutiplication instructions")
  (:use :cl :rvasm :m-32-rv :test-rvasm)
  )

(in-package :test-m-32)

(combine-results

(do-vait-test m.mul
  ((x0 x0 x0    #b00000010000000000000000000110011)
   (x31 x0 x0   #b00000010000000000000111110110011)
   (x0 x31 x0   #b00000010000011111000000000110011)
   (x31 x31 x0  #b00000010000011111000111110110011)
   (x0 x0 x31   #b00000011111100000000000000110011)
   (x31 x0 x31  #b00000011111100000000111110110011)
   (x0 x31 x31  #b00000011111111111000000000110011)
   (x31 x31 x31 #b00000011111111111000111110110011)))


(do-vait-test m.mulh
  ((x0 x0 x0    #b00000010000000000001000000110011)
   (x31 x0 x0   #b00000010000000000001111110110011)
   (x0 x31 x0   #b00000010000011111001000000110011)
   (x31 x31 x0  #b00000010000011111001111110110011)
   (x0 x0 x31   #b00000011111100000001000000110011)
   (x31 x0 x31  #b00000011111100000001111110110011)
   (x0 x31 x31  #b00000011111111111001000000110011)
   (x31 x31 x31 #b00000011111111111001111110110011)))


(do-vait-test m.mulhsu
  ((x0 x0 x0    #b00000010000000000010000000110011)
   (x31 x0 x0   #b00000010000000000010111110110011)
   (x0 x31 x0   #b00000010000011111010000000110011)
   (x31 x31 x0  #b00000010000011111010111110110011)
   (x0 x0 x31   #b00000011111100000010000000110011)
   (x31 x0 x31  #b00000011111100000010111110110011)
   (x0 x31 x31  #b00000011111111111010000000110011)
   (x31 x31 x31 #b00000011111111111010111110110011)))


(do-vait-test m.mulhu
  ((x0 x0 x0    #b00000010000000000011000000110011)
   (x31 x0 x0   #b00000010000000000011111110110011)
   (x0 x31 x0   #b00000010000011111011000000110011)
   (x31 x31 x0  #b00000010000011111011111110110011)
   (x0 x0 x31   #b00000011111100000011000000110011)
   (x31 x0 x31  #b00000011111100000011111110110011)
   (x0 x31 x31  #b00000011111111111011000000110011)
   (x31 x31 x31 #b00000011111111111011111110110011)))


(do-vait-test m.div
  ((x0 x0 x0    #b00000010000000000100000000110011)
   (x31 x0 x0   #b00000010000000000100111110110011)
   (x0 x31 x0   #b00000010000011111100000000110011)
   (x31 x31 x0  #b00000010000011111100111110110011)
   (x0 x0 x31   #b00000011111100000100000000110011)
   (x31 x0 x31  #b00000011111100000100111110110011)
   (x0 x31 x31  #b00000011111111111100000000110011)
   (x31 x31 x31 #b00000011111111111100111110110011)))


(do-vait-test m.divu
  ((x0 x0 x0    #b00000010000000000101000000110011)
   (x31 x0 x0   #b00000010000000000101111110110011)
   (x0 x31 x0   #b00000010000011111101000000110011)
   (x31 x31 x0  #b00000010000011111101111110110011)
   (x0 x0 x31   #b00000011111100000101000000110011)
   (x31 x0 x31  #b00000011111100000101111110110011)
   (x0 x31 x31  #b00000011111111111101000000110011)
   (x31 x31 x31 #b00000011111111111101111110110011)))


(do-vait-test m.rem
  ((x0 x0 x0    #b00000010000000000110000000110011)
   (x31 x0 x0   #b00000010000000000110111110110011)
   (x0 x31 x0   #b00000010000011111110000000110011)
   (x31 x31 x0  #b00000010000011111110111110110011)
   (x0 x0 x31   #b00000011111100000110000000110011)
   (x31 x0 x31  #b00000011111100000110111110110011)
   (x0 x31 x31  #b00000011111111111110000000110011)
   (x31 x31 x31 #b00000011111111111110111110110011)))


(do-vait-test m.remu
  ((x0 x0 x0    #b00000010000000000111000000110011)
   (x31 x0 x0   #b00000010000000000111111110110011)
   (x0 x31 x0   #b00000010000011111111000000110011)
   (x31 x31 x0  #b00000010000011111111111110110011)
   (x0 x0 x31   #b00000011111100000111000000110011)
   (x31 x0 x31  #b00000011111100000111111110110011)
   (x0 x31 x31  #b00000011111111111111000000110011)
   (x31 x31 x31 #b00000011111111111111111110110011)))

)

;; (defpackage "TEST-M-64"
;;   (:documentation "Test functions for the risc-v 64 bit mutiplication instructions")
;;   (:use :cl :rvasm :m-32-rv :m-64-rv  :test-rvasm :test-m-64)
;;   )

;; (in-package :test-m-32)




  ;; (mulv     #b00000010000000000000000000111011 #x200003b 4 r (rd rs1 rs2))
  ;; (divv     #b00000010000000000100000000111011 #x200403b 4 r (rd rs1 rs2))
  ;; (divuv    #b00000010000000000101000000111011 #x200503b 4 r (rd rs1 rs2))
  ;; (remv     #b00000010000000000110000000111011 #x200603b 4 r (rd rs1 rs2))
  ;; (remuv    #b00000010000000000111000000111011 #x200703b 4 r (rd rs1 rs2))
